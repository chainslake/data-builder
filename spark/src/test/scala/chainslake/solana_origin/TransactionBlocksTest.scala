package chainslake.solana_origin

import chainslake.ChainslakeTest
import chainslake.solana.ResponseRawNumber
import chainslake.solana.origin.TransactionBlocks
import com.google.gson.Gson
import org.apache.spark.sql.SaveMode
import scalaj.http.HttpResponse

class TransactionBlocksTest extends ChainslakeTest {

  def mockRpcCall(rpc: String, body: String): HttpResponse[String] = {
    var result = ""
    if (body.contains("getSlot")) {
      result = """{"jsonrpc":"2.0","result":348281550,"id":1}"""
    } else {
      result = """{"jsonrpc":"2.0","result":{"blockHeight":326485569,"blockTime":1750522834,"blockhash":"65xJobJePHjN5jRS49S2cLuvqoDv5XHedeoo9rg5zX6s","parentSlot":348281549,"previousBlockhash":"5Ps9kX4fg64BrZVygGJ91cn7HzH5MaUqdpy88VaFKpQF","rewards":[{"commission":null,"lamports":10262635,"postBalance":12504428927,"pubkey":"hyp3Eo67t6FgeuWg5Qxbeme8NPXJPXXdKT4iJ4DsLf2","rewardType":"Fee"}],"transactions":[{"meta":{"computeUnitsConsumed":1613,"err":{"InstructionError":[2,{"Custom":7}]},"fee":11000,"innerInstructions":[],"logMessages":["Program ComputeBudget111111111111111111111111111111 invoke [1]","Program ComputeBudget111111111111111111111111111111 success","Program ComputeBudget111111111111111111111111111111 invoke [1]","Program ComputeBudget111111111111111111111111111111 success","Program ZERor4xhbUycZ6gb9ntrhqscUcZmAbQDjEAtCf4hbZY invoke [1]","Program ZERor4xhbUycZ6gb9ntrhqscUcZmAbQDjEAtCf4hbZY consumed 1313 of 1700 compute units","Program ZERor4xhbUycZ6gb9ntrhqscUcZmAbQDjEAtCf4hbZY failed: custom program error: 0x7"],"postBalances":[3919696494,52784640,1,1141440],"postTokenBalances":[],"preBalances":[3919707494,52784640,1,1141440],"preTokenBalances":[],"rewards":[],"status":{"Err":{"InstructionError":[2,{"Custom":7}]}}},"transaction":{"message":{"accountKeys":[{"pubkey":"updtkJ8HAhh3rSkBCd3p9Z1Q74yJW4rMhSbScRskDPM","signer":true,"source":"transaction","writable":true},{"pubkey":"2UJMqTMhAKhWQGN5V3tQY3U1mRb3xvAunJ6BggbJGLzT","signer":false,"source":"transaction","writable":true},{"pubkey":"ComputeBudget111111111111111111111111111111","signer":false,"source":"transaction","writable":false},{"pubkey":"ZERor4xhbUycZ6gb9ntrhqscUcZmAbQDjEAtCf4hbZY","signer":false,"source":"transaction","writable":false}],"addressTableLookups":[],"instructions":[{"accounts":[],"data":"3mhiKuxuaKy1","programId":"ComputeBudget111111111111111111111111111111","stackHeight":null},{"accounts":[],"data":"KQUSGo","programId":"ComputeBudget111111111111111111111111111111","stackHeight":null},{"accounts":["updtkJ8HAhh3rSkBCd3p9Z1Q74yJW4rMhSbScRskDPM","2UJMqTMhAKhWQGN5V3tQY3U1mRb3xvAunJ6BggbJGLzT"],"data":"3x3P9n19DqhqiiMc3hKngDpjfQ7urMt3w8JRa756S34nLZWDddp7qk8MmCdGdWZRdhmvq5BHGRqSPFpByshwh1rfsDax1V","programId":"ZERor4xhbUycZ6gb9ntrhqscUcZmAbQDjEAtCf4hbZY","stackHeight":null}],"recentBlockhash":"Fa9uxKGDz4w2SeZPYzbeXBSaas8W761XscWcJXntaqX1"},"signatures":["2Gd6dEWEHVFHzRHXnSYt5jv9eyAS42vd8qrqBAWySdiXuLde4NUumCyZuVWgp8AQUyR4XQkTkSyk8WVF2YzCRFjw"]},"version":0},{"meta":{"computeUnitsConsumed":68992,"err":{"InstructionError":[2,{"Custom":1}]},"fee":117193,"innerInstructions":[],"logMessages":["Program ComputeBudget111111111111111111111111111111 invoke [1]","Program ComputeBudget111111111111111111111111111111 success","Program ComputeBudget111111111111111111111111111111 invoke [1]","Program ComputeBudget111111111111111111111111111111 success","Program MEViEnscUm6tsQRoGd9h6nLQaQspKj7DB2M5FwM3Xvz invoke [1]","Program log: SolanaMevBot.com","Program log: No profitable arbitrage opportunity found","Program MEViEnscUm6tsQRoGd9h6nLQaQspKj7DB2M5FwM3Xvz consumed 68692 of 380191 compute units","Program MEViEnscUm6tsQRoGd9h6nLQaQspKj7DB2M5FwM3Xvz failed: custom program error: 0x1"],"postBalances":[19192936613,967978618,2039280,18174811244,71437440,71437440,71437440,71437440,71437440,71437440,71437440,71437440,0,71437440,71437440,71437440,1,1141440,3313226139,2978880,2039280,4837904016977,0,7182720,2039280,13797834031892,23385600,7182720,2039280,355064390834,23385600,7182720,2039280,32046971982,23385600,7182720,2039280,3352775384410,23385600,288262470851,3410050557743,1062378321262,934087680,1,731913600,1141440,4454454,0,15670276077344,1141440,4000400],"postTokenBalances":[{"accountIndex":1,"mint":"So11111111111111111111111111111111111111112","owner":"Feex8T4D9gJCoE6oNgmUcErmcRVvmoiL5KJjNBBiN9PK","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"965939338","decimals":9,"uiAmount":0.965939338,"uiAmountString":"0.965939338"}},{"accountIndex":2,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"jayzzb3pcTHskjsqkw5Adozzj27eG42XzZMo9aSQvhQ","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"0","decimals":6,"uiAmount":null,"uiAmountString":"0"}},{"accountIndex":3,"mint":"So11111111111111111111111111111111111111112","owner":"EPmm3zFvbzQVw2Cbs16E2yJwcRwDmECfzwDTbKQajVu7","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"18172771964","decimals":9,"uiAmount":18.172771964,"uiAmountString":"18.172771964"}},{"accountIndex":20,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"H66r4cb3LrvEZowN6eJZxMVbjrzxmRzPRT7Z6aMEXunb","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"13934550228875","decimals":6,"uiAmount":13934550.228875,"uiAmountString":"13934550.228875"}},{"accountIndex":21,"mint":"So11111111111111111111111111111111111111112","owner":"H66r4cb3LrvEZowN6eJZxMVbjrzxmRzPRT7Z6aMEXunb","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"4837901977697","decimals":9,"uiAmount":4837.901977697,"uiAmountString":"4837.901977697"}},{"accountIndex":24,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"CpaQjgRZuVJ9yv4ewnZXuFhoy2VUwr4pStbTSHvHtK4w","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"6650942108283","decimals":6,"uiAmount":6650942.108283,"uiAmountString":"6650942.108283"}},{"accountIndex":25,"mint":"So11111111111111111111111111111111111111112","owner":"CpaQjgRZuVJ9yv4ewnZXuFhoy2VUwr4pStbTSHvHtK4w","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"13797831992612","decimals":9,"uiAmount":13797.831992612,"uiAmountString":"13797.831992612"}},{"accountIndex":28,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"3CGpV2Vqx5KGKq1xigmNv8VhvepuQdwvEQwdB4wNasWE","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"4279705232066","decimals":6,"uiAmount":4279705.232066,"uiAmountString":"4279705.232066"}},{"accountIndex":29,"mint":"So11111111111111111111111111111111111111112","owner":"3CGpV2Vqx5KGKq1xigmNv8VhvepuQdwvEQwdB4wNasWE","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"355062351554","decimals":9,"uiAmount":355.062351554,"uiAmountString":"355.062351554"}},{"accountIndex":32,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"wghMYJBaZZVgtX6RTCZ6Zh9dpiBSueDxX4pSLW6sJEa","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"3057462142012","decimals":6,"uiAmount":3057462.142012,"uiAmountString":"3057462.142012"}},{"accountIndex":33,"mint":"So11111111111111111111111111111111111111112","owner":"wghMYJBaZZVgtX6RTCZ6Zh9dpiBSueDxX4pSLW6sJEa","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"32044932702","decimals":9,"uiAmount":32.044932702,"uiAmountString":"32.044932702"}},{"accountIndex":36,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"2fCWHEyzgnULbhrMoKTDwc2n6jy6zhxC9frEJFuHJVGW","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"1179232991755","decimals":6,"uiAmount":1179232.991755,"uiAmountString":"1179232.991755"}},{"accountIndex":37,"mint":"So11111111111111111111111111111111111111112","owner":"2fCWHEyzgnULbhrMoKTDwc2n6jy6zhxC9frEJFuHJVGW","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"3352773345130","decimals":9,"uiAmount":3352.77334513,"uiAmountString":"3352.77334513"}},{"accountIndex":39,"mint":"So11111111111111111111111111111111111111112","owner":"jayzzb3pcTHskjsqkw5Adozzj27eG42XzZMo9aSQvhQ","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"288260431571","decimals":9,"uiAmount":288.260431571,"uiAmountString":"288.260431571"}},{"accountIndex":40,"mint":"So11111111111111111111111111111111111111112","owner":"FWsW1xNtWscwNmKv6wVsU1iTzRN6wmmk3MjxRP5tT7hz","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"3410048518463","decimals":9,"uiAmount":3410.048518463,"uiAmountString":"3410.048518463"}}],"preBalances":[19193053806,967978618,2039280,18174811244,71437440,71437440,71437440,71437440,71437440,71437440,71437440,71437440,0,71437440,71437440,71437440,1,1141440,3313226139,2978880,2039280,4837904016977,0,7182720,2039280,13797834031892,23385600,7182720,2039280,355064390834,23385600,7182720,2039280,32046971982,23385600,7182720,2039280,3352775384410,23385600,288262470851,3410050557743,1062378321262,934087680,1,731913600,1141440,4454454,0,15670276077344,1141440,4000400],"preTokenBalances":[{"accountIndex":1,"mint":"So11111111111111111111111111111111111111112","owner":"Feex8T4D9gJCoE6oNgmUcErmcRVvmoiL5KJjNBBiN9PK","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"965939338","decimals":9,"uiAmount":0.965939338,"uiAmountString":"0.965939338"}},{"accountIndex":2,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"jayzzb3pcTHskjsqkw5Adozzj27eG42XzZMo9aSQvhQ","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"0","decimals":6,"uiAmount":null,"uiAmountString":"0"}},{"accountIndex":3,"mint":"So11111111111111111111111111111111111111112","owner":"EPmm3zFvbzQVw2Cbs16E2yJwcRwDmECfzwDTbKQajVu7","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"18172771964","decimals":9,"uiAmount":18.172771964,"uiAmountString":"18.172771964"}},{"accountIndex":20,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"H66r4cb3LrvEZowN6eJZxMVbjrzxmRzPRT7Z6aMEXunb","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"13934550228875","decimals":6,"uiAmount":13934550.228875,"uiAmountString":"13934550.228875"}},{"accountIndex":21,"mint":"So11111111111111111111111111111111111111112","owner":"H66r4cb3LrvEZowN6eJZxMVbjrzxmRzPRT7Z6aMEXunb","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"4837901977697","decimals":9,"uiAmount":4837.901977697,"uiAmountString":"4837.901977697"}},{"accountIndex":24,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"CpaQjgRZuVJ9yv4ewnZXuFhoy2VUwr4pStbTSHvHtK4w","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"6650942108283","decimals":6,"uiAmount":6650942.108283,"uiAmountString":"6650942.108283"}},{"accountIndex":25,"mint":"So11111111111111111111111111111111111111112","owner":"CpaQjgRZuVJ9yv4ewnZXuFhoy2VUwr4pStbTSHvHtK4w","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"13797831992612","decimals":9,"uiAmount":13797.831992612,"uiAmountString":"13797.831992612"}},{"accountIndex":28,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"3CGpV2Vqx5KGKq1xigmNv8VhvepuQdwvEQwdB4wNasWE","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"4279705232066","decimals":6,"uiAmount":4279705.232066,"uiAmountString":"4279705.232066"}},{"accountIndex":29,"mint":"So11111111111111111111111111111111111111112","owner":"3CGpV2Vqx5KGKq1xigmNv8VhvepuQdwvEQwdB4wNasWE","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"355062351554","decimals":9,"uiAmount":355.062351554,"uiAmountString":"355.062351554"}},{"accountIndex":32,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"wghMYJBaZZVgtX6RTCZ6Zh9dpiBSueDxX4pSLW6sJEa","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"3057462142012","decimals":6,"uiAmount":3057462.142012,"uiAmountString":"3057462.142012"}},{"accountIndex":33,"mint":"So11111111111111111111111111111111111111112","owner":"wghMYJBaZZVgtX6RTCZ6Zh9dpiBSueDxX4pSLW6sJEa","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"32044932702","decimals":9,"uiAmount":32.044932702,"uiAmountString":"32.044932702"}},{"accountIndex":36,"mint":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","owner":"2fCWHEyzgnULbhrMoKTDwc2n6jy6zhxC9frEJFuHJVGW","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"1179232991755","decimals":6,"uiAmount":1179232.991755,"uiAmountString":"1179232.991755"}},{"accountIndex":37,"mint":"So11111111111111111111111111111111111111112","owner":"2fCWHEyzgnULbhrMoKTDwc2n6jy6zhxC9frEJFuHJVGW","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"3352773345130","decimals":9,"uiAmount":3352.77334513,"uiAmountString":"3352.77334513"}},{"accountIndex":39,"mint":"So11111111111111111111111111111111111111112","owner":"jayzzb3pcTHskjsqkw5Adozzj27eG42XzZMo9aSQvhQ","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"288260431571","decimals":9,"uiAmount":288.260431571,"uiAmountString":"288.260431571"}},{"accountIndex":40,"mint":"So11111111111111111111111111111111111111112","owner":"FWsW1xNtWscwNmKv6wVsU1iTzRN6wmmk3MjxRP5tT7hz","programId":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","uiTokenAmount":{"amount":"3410048518463","decimals":9,"uiAmount":3410.048518463,"uiAmountString":"3410.048518463"}}],"rewards":[],"status":{"Err":{"InstructionError":[2,{"Custom":1}]}}},"transaction":{"message":{"accountKeys":[{"pubkey":"jayzzb3pcTHskjsqkw5Adozzj27eG42XzZMo9aSQvhQ","signer":true,"source":"transaction","writable":true},{"pubkey":"GPpkDpzCDmYJY5qNhYmM14c7rct1zmkjWc2CjR5g7RZ1","signer":false,"source":"transaction","writable":true},{"pubkey":"9ujfHTA3XiSfbmMZnPYgz945scQHNFFf8dn86hj26wGs","signer":false,"source":"transaction","writable":true},{"pubkey":"5JqkawMDYts8LXu74bzSUT3GpuK83gVZWZ8h79DYRtJM","signer":false,"source":"transaction","writable":true},{"pubkey":"4UA39JqBxGuErgFACF4q7uiSGRFD4aU5uksB8qYooutb","signer":false,"source":"transaction","writable":true},{"pubkey":"2M1esnGP6PtPMinLF8c5bGcqSwLXTyGTTiqtJ9kaFsbS","signer":false,"source":"transaction","writable":true},{"pubkey":"DVxPQ8f2G237SqQFYGJHWaoY6QjrBMiSVZFvD1u94Ua","signer":false,"source":"transaction","writable":true},{"pubkey":"8gTsboWF6Gi9baeVxJo3K8G4quRq8f9tLuSMPjJvFjsU","signer":false,"source":"transaction","writable":true},{"pubkey":"8V3GNx8DAPjGunYkknzEDe7zu93enHeB3vbrfq1dySSg","signer":false,"source":"transaction","writable":true},{"pubkey":"4SRZpqFY4KMjW4DEXKKa4sgDaAyKec8p5tzA6TERTMKT","signer":false,"source":"transaction","writable":true},{"pubkey":"BKR5TNULBcgjzQtDoxYwPd8Yj9utTRr7Yy5c66agwHwh","signer":false,"source":"transaction","writable":true},{"pubkey":"AmaDktw6e2nguy2XMmZ4dghBjuESq2HXzEsZTMy2BA5S","signer":false,"source":"transaction","writable":true},{"pubkey":"B8nt3ZX1cLm84LtuYDruZrQwJrcixKuk4GWUFvNH2G4k","signer":false,"source":"transaction","writable":true},{"pubkey":"HjibvWdMYZ9LJtoPeb1fgVS63qDumUfcdMQipGRcnfNp","signer":false,"source":"transaction","writable":true},{"pubkey":"2Ws7HgrCeu8FZdJdahCB4LEKEkbfie2wyYjFuJ9kP5DK","signer":false,"source":"transaction","writable":true},{"pubkey":"66mdiq7QQd5WJb4wssqjn9B2bYyaYpAbGYqwgvrBvSSP","signer":false,"source":"transaction","writable":true},{"pubkey":"ComputeBudget111111111111111111111111111111","signer":false,"source":"transaction","writable":false},{"pubkey":"MEViEnscUm6tsQRoGd9h6nLQaQspKj7DB2M5FwM3Xvz","signer":false,"source":"transaction","writable":false},{"pubkey":"71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","signer":false,"source":"transaction","writable":false},{"pubkey":"H66r4cb3LrvEZowN6eJZxMVbjrzxmRzPRT7Z6aMEXunb","signer":false,"source":"lookupTable","writable":true},{"pubkey":"CZ16XBCeBBUNvs6xK88HpB34XqWcU2SszwPTT2wb1AZg","signer":false,"source":"lookupTable","writable":true},{"pubkey":"C5Dyvuaiad4heVtTiFeKAsuL7NNyfcGnKbX3RnmuEurR","signer":false,"source":"lookupTable","writable":true},{"pubkey":"EPmm3zFvbzQVw2Cbs16E2yJwcRwDmECfzwDTbKQajVu7","signer":false,"source":"lookupTable","writable":true},{"pubkey":"CpaQjgRZuVJ9yv4ewnZXuFhoy2VUwr4pStbTSHvHtK4w","signer":false,"source":"lookupTable","writable":true},{"pubkey":"244VmJByyqUT1Nag3o9zguXP4rpQEk8DvgT6cNNgQuR8","signer":false,"source":"lookupTable","writable":true},{"pubkey":"EnMQo4rs2TGb2bt6wy2BBrrAtLnr8aFY3fsMw4u4XBD1","signer":false,"source":"lookupTable","writable":true},{"pubkey":"BvnjhVLBC2r96sHKd17TC4BEf7F7vcMFWamn3P29jeNr","signer":false,"source":"lookupTable","writable":true},{"pubkey":"3CGpV2Vqx5KGKq1xigmNv8VhvepuQdwvEQwdB4wNasWE","signer":false,"source":"lookupTable","writable":true},{"pubkey":"6WM14aD46hqAEYZsc1SDXPwqaKGBSZ68fMH9tWqMGjuj","signer":false,"source":"lookupTable","writable":true},{"pubkey":"BSW5KSVCxWK6t5Y2JnzfbpiZ1UX6zqYNnxLGx44gnco1","signer":false,"source":"lookupTable","writable":true},{"pubkey":"JD3GfWYNsMREFjv5SK3vkNoBJC3h2aHppoEBZwKGFxpa","signer":false,"source":"lookupTable","writable":true},{"pubkey":"wghMYJBaZZVgtX6RTCZ6Zh9dpiBSueDxX4pSLW6sJEa","signer":false,"source":"lookupTable","writable":true},{"pubkey":"3XyJP2E5FWq8jo1uGtLaPixaqWvDqyKicv23j3P2Koj1","signer":false,"source":"lookupTable","writable":true},{"pubkey":"3XdvPQJyPpNNXBrQAaXZkHvytFVg4ymDqSg36Aye7LtK","signer":false,"source":"lookupTable","writable":true},{"pubkey":"EJRuXc1vuGALQGF8A6BCHPvbkqcSLrDnzntfJNm8Mx6H","signer":false,"source":"lookupTable","writable":true},{"pubkey":"2fCWHEyzgnULbhrMoKTDwc2n6jy6zhxC9frEJFuHJVGW","signer":false,"source":"lookupTable","writable":true},{"pubkey":"D3iNTzsCzt95kRHkSUpbik28NdDZxDD6mPQgDnNN62FL","signer":false,"source":"lookupTable","writable":true},{"pubkey":"D1KNF4QcWzdwBjafNWkKsNew4xpHxLpW7aDeKRSTG2YG","signer":false,"source":"lookupTable","writable":true},{"pubkey":"238Yz91bT4BaAkKPKvK2XDGSKEccrN4vWBd5oqB4s6Ex","signer":false,"source":"lookupTable","writable":true},{"pubkey":"DL46Z6j5s4nDvcCtmccctpj5bpoQcUEHU9ivg6mHB6iA","signer":false,"source":"lookupTable","writable":true},{"pubkey":"7xQYoUjUJF1Kg6WVczoTAkaNhn5syQYcbvjmFrhjWpx","signer":false,"source":"lookupTable","writable":true},{"pubkey":"So11111111111111111111111111111111111111112","signer":false,"source":"lookupTable","writable":false},{"pubkey":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","signer":false,"source":"lookupTable","writable":false},{"pubkey":"11111111111111111111111111111111","signer":false,"source":"lookupTable","writable":false},{"pubkey":"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL","signer":false,"source":"lookupTable","writable":false},{"pubkey":"pAMMBay6oceH9fJKBRHGP5D4bD4sWpmSwMn52FMfXEA","signer":false,"source":"lookupTable","writable":false},{"pubkey":"ADyA8hdefvWN2dbGGWFotbzWxrAvLW83WG6QCVXvJKqw","signer":false,"source":"lookupTable","writable":false},{"pubkey":"GS4CU59F31iL7aR2Q8zVS8DRrcRnXX1yjQ66TqNVQnaR","signer":false,"source":"lookupTable","writable":false},{"pubkey":"FWsW1xNtWscwNmKv6wVsU1iTzRN6wmmk3MjxRP5tT7hz","signer":false,"source":"lookupTable","writable":false},{"pubkey":"LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo","signer":false,"source":"lookupTable","writable":false},{"pubkey":"D1ZN9Wj1fRSUQfCjhvnu1hqDMT7hzjzBBpi12nVniYD6","signer":false,"source":"lookupTable","writable":false}],"addressTableLookups":[{"accountKey":"2qHDtp14McmMLLNqVwU4WRcoQogkg5sViPpknmmcHnGT","readonlyIndexes":[],"writableIndexes":[86,84,85,87,59,56,57,58,63,60,61,62,67,64,65,66,95,92,93,94]},{"accountKey":"13wE68ZmcDMJvpethiJHN1oYf67rpntvhSze74mVyR47","readonlyIndexes":[6,0,166,5,101,99,100,88,10,19],"writableIndexes":[180,96]}],"instructions":[{"accounts":[],"data":"G2Sw1H","programId":"ComputeBudget111111111111111111111111111111","stackHeight":null},{"accounts":[],"data":"3pAY1b719DSf","programId":"ComputeBudget111111111111111111111111111111","stackHeight":null},{"accounts":["jayzzb3pcTHskjsqkw5Adozzj27eG42XzZMo9aSQvhQ","So11111111111111111111111111111111111111112","GPpkDpzCDmYJY5qNhYmM14c7rct1zmkjWc2CjR5g7RZ1","DL46Z6j5s4nDvcCtmccctpj5bpoQcUEHU9ivg6mHB6iA","TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","11111111111111111111111111111111","ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL","71Jvq4Epe2FCJ7JFSF7jLXdNk1Wy4Bhqd9iL6bEFELvg","TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA","9ujfHTA3XiSfbmMZnPYgz945scQHNFFf8dn86hj26wGs","pAMMBay6oceH9fJKBRHGP5D4bD4sWpmSwMn52FMfXEA","ADyA8hdefvWN2dbGGWFotbzWxrAvLW83WG6QCVXvJKqw","GS4CU59F31iL7aR2Q8zVS8DRrcRnXX1yjQ66TqNVQnaR","FWsW1xNtWscwNmKv6wVsU1iTzRN6wmmk3MjxRP5tT7hz","H66r4cb3LrvEZowN6eJZxMVbjrzxmRzPRT7Z6aMEXunb","CZ16XBCeBBUNvs6xK88HpB34XqWcU2SszwPTT2wb1AZg","C5Dyvuaiad4heVtTiFeKAsuL7NNyfcGnKbX3RnmuEurR","7xQYoUjUJF1Kg6WVczoTAkaNhn5syQYcbvjmFrhjWpx","5JqkawMDYts8LXu74bzSUT3GpuK83gVZWZ8h79DYRtJM","EPmm3zFvbzQVw2Cbs16E2yJwcRwDmECfzwDTbKQajVu7","LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo","D1ZN9Wj1fRSUQfCjhvnu1hqDMT7hzjzBBpi12nVniYD6","CpaQjgRZuVJ9yv4ewnZXuFhoy2VUwr4pStbTSHvHtK4w","244VmJByyqUT1Nag3o9zguXP4rpQEk8DvgT6cNNgQuR8","EnMQo4rs2TGb2bt6wy2BBrrAtLnr8aFY3fsMw4u4XBD1","BvnjhVLBC2r96sHKd17TC4BEf7F7vcMFWamn3P29jeNr","4UA39JqBxGuErgFACF4q7uiSGRFD4aU5uksB8qYooutb","2M1esnGP6PtPMinLF8c5bGcqSwLXTyGTTiqtJ9kaFsbS","DVxPQ8f2G237SqQFYGJHWaoY6QjrBMiSVZFvD1u94Ua","LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo","D1ZN9Wj1fRSUQfCjhvnu1hqDMT7hzjzBBpi12nVniYD6","3CGpV2Vqx5KGKq1xigmNv8VhvepuQdwvEQwdB4wNasWE","6WM14aD46hqAEYZsc1SDXPwqaKGBSZ68fMH9tWqMGjuj","BSW5KSVCxWK6t5Y2JnzfbpiZ1UX6zqYNnxLGx44gnco1","JD3GfWYNsMREFjv5SK3vkNoBJC3h2aHppoEBZwKGFxpa","8gTsboWF6Gi9baeVxJo3K8G4quRq8f9tLuSMPjJvFjsU","8V3GNx8DAPjGunYkknzEDe7zu93enHeB3vbrfq1dySSg","4SRZpqFY4KMjW4DEXKKa4sgDaAyKec8p5tzA6TERTMKT","LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo","D1ZN9Wj1fRSUQfCjhvnu1hqDMT7hzjzBBpi12nVniYD6","wghMYJBaZZVgtX6RTCZ6Zh9dpiBSueDxX4pSLW6sJEa","3XyJP2E5FWq8jo1uGtLaPixaqWvDqyKicv23j3P2Koj1","3XdvPQJyPpNNXBrQAaXZkHvytFVg4ymDqSg36Aye7LtK","EJRuXc1vuGALQGF8A6BCHPvbkqcSLrDnzntfJNm8Mx6H","BKR5TNULBcgjzQtDoxYwPd8Yj9utTRr7Yy5c66agwHwh","AmaDktw6e2nguy2XMmZ4dghBjuESq2HXzEsZTMy2BA5S","B8nt3ZX1cLm84LtuYDruZrQwJrcixKuk4GWUFvNH2G4k","LBUZKhRxPF3XUpBCjp4YzTKgLccjZhTSDM9YuVaPwxo","D1ZN9Wj1fRSUQfCjhvnu1hqDMT7hzjzBBpi12nVniYD6","2fCWHEyzgnULbhrMoKTDwc2n6jy6zhxC9frEJFuHJVGW","D3iNTzsCzt95kRHkSUpbik28NdDZxDD6mPQgDnNN62FL","D1KNF4QcWzdwBjafNWkKsNew4xpHxLpW7aDeKRSTG2YG","238Yz91bT4BaAkKPKvK2XDGSKEccrN4vWBd5oqB4s6Ex","HjibvWdMYZ9LJtoPeb1fgVS63qDumUfcdMQipGRcnfNp","2Ws7HgrCeu8FZdJdahCB4LEKEkbfie2wyYjFuJ9kP5DK","66mdiq7QQd5WJb4wssqjn9B2bYyaYpAbGYqwgvrBvSSP"],"data":"2bjJFnyP79b5FHch92ycLqxMs3f9h","programId":"MEViEnscUm6tsQRoGd9h6nLQaQspKj7DB2M5FwM3Xvz","stackHeight":null}],"recentBlockhash":"DSU7tW7vm8pgaupEoXNyJvAwaRRaaFbmnD64bMQx3Fhx"},"signatures":["dfYrx2VrkBFbv7a1PxU3HGQgKYGLEvFt1ipcQko2QNhy5QgrZhx1Xa3iKSpJ3srhVLF6HVSLU1FW9BYahnHLafh"]},"version":0}]},"id":1}"""
    }

    HttpResponse[String](
      body = result,
      code = 200,
      headers = Map()
    )
  }

  test("processCrawlBlocks") {
    TransactionBlocks.rpcCall = mockRpcCall
    val result = TransactionBlocks.processCrawlBlocks(spark, 348281550, 348281550, properties)
    assert(result.count() == 1)
//    result.show()
//    spark.sql(s"create database if not exists solana_origin")
//    result.write
//      .mode(SaveMode.Overwrite).format("delta")
//      .saveAsTable("solana_origin.transaction_blocks")
  }

  test("getLatestInput") {
    TransactionBlocks.rpcCall = mockRpcCall
    val result = TransactionBlocks.getLatestInput(spark, properties)
    assert(result == 348281550)
  }

  ignore("defaultRpcCall") {
    val rpc = ""
    val gson = new Gson()

    // Get latest block
    var result = TransactionBlocks.defaultRpcCall(rpc, s"""{"method":"getSlot","params":[],"id":1,"jsonrpc":"2.0"}""")
    println(result.body)
    // {"jsonrpc":"2.0","result":348281550,"id":1}
    val latestBlock = gson.fromJson(result.body, classOf[ResponseRawNumber]).result

    // Get block
    result = TransactionBlocks.defaultRpcCall(rpc, s"""{"method":"getBlock","params":[$latestBlock, {"encoding": "jsonParsed","maxSupportedTransactionVersion":0,"transactionDetails":"full","rewards":true}],"id":1,"jsonrpc":"2.0"}""")
    println(result.body)

  }
}
